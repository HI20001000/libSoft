{"remainingRequest":"C:\\Users\\maxch\\Desktop\\Bookmanager-master\\project\\Bookmanager-master\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\maxch\\Desktop\\Bookmanager-master\\project\\Bookmanager-master\\src\\permission.js","dependencies":[{"path":"C:\\Users\\maxch\\Desktop\\Bookmanager-master\\project\\Bookmanager-master\\src\\permission.js","mtime":1700232500000},{"path":"C:\\Users\\maxch\\Desktop\\Bookmanager-master\\project\\Bookmanager-master\\babel.config.js","mtime":1700232500000},{"path":"C:\\Users\\maxch\\Desktop\\Bookmanager-master\\project\\Bookmanager-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1700232500000},{"path":"C:\\Users\\maxch\\Desktop\\Bookmanager-master\\project\\Bookmanager-master\\node_modules\\babel-loader\\lib\\index.js","mtime":1700232500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9yZWdlbmVyYXRvclJ1bnRpbWUgZnJvbSAiQzovVXNlcnMvbWF4Y2gvRGVza3RvcC9Cb29rbWFuYWdlci1tYXN0ZXIvcHJvamVjdC9Cb29rbWFuYWdlci1tYXN0ZXIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3JlZ2VuZXJhdG9yUnVudGltZS5qcyI7CmltcG9ydCBfb2JqZWN0U3ByZWFkIGZyb20gIkM6L1VzZXJzL21heGNoL0Rlc2t0b3AvQm9va21hbmFnZXItbWFzdGVyL3Byb2plY3QvQm9va21hbmFnZXItbWFzdGVyL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyLmpzIjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkM6L1VzZXJzL21heGNoL0Rlc2t0b3AvQm9va21hbmFnZXItbWFzdGVyL3Byb2plY3QvQm9va21hbmFnZXItbWFzdGVyL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yLmpzIjsKLyoKICogQERlc2NyaXB0aW9uOiAKICogQEF1dGhvcjogUmFiYml0ZXIKICogQERhdGU6IDIwMjMtMDItMjEgMTg6MTM6MjEKICovCmltcG9ydCByb3V0ZXIgZnJvbSAnLi9yb3V0ZXInOwppbXBvcnQgc3RvcmUgZnJvbSAnLi9zdG9yZSc7CmltcG9ydCB7IE1lc3NhZ2UgfSBmcm9tICdlbGVtZW50LXVpJzsKaW1wb3J0ICJAL2FwaS9pbml0aWFsaXplIjsKaW1wb3J0IE5Qcm9ncmVzcyBmcm9tICducHJvZ3Jlc3MnOyAvLyBwcm9ncmVzcyBiYXIKaW1wb3J0ICducHJvZ3Jlc3MvbnByb2dyZXNzLmNzcyc7IC8vIHByb2dyZXNzIGJhciBzdHlsZQppbXBvcnQgeyBnZXRUb2tlbiB9IGZyb20gJ0AvdXRpbHMvYXV0aCc7IC8vIGdldCB0b2tlbiBmcm9tIGNvb2tpZQppbXBvcnQgZ2V0UGFnZVRpdGxlIGZyb20gJ0AvdXRpbHMvZ2V0LXBhZ2UtdGl0bGUnOwpOUHJvZ3Jlc3MuY29uZmlndXJlKHsKICBzaG93U3Bpbm5lcjogZmFsc2UKfSk7IC8vIE5Qcm9ncmVzcyBDb25maWd1cmF0aW9uCgp2YXIgd2hpdGVMaXN0ID0gWycvbG9naW4nLCAnL3JlZ2lzdGVyJ107IC8vIOayoeaciemHjeWumuWQkeeZveWQjeWNlQoKcm91dGVyLmJlZm9yZUVhY2goIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUodG8sIGZyb20sIG5leHQpIHsKICAgIHZhciBoYXNUb2tlbiwgaGFzUm9sZXMsIF95aWVsZCRzdG9yZSRkaXNwYXRjaCwgcm9sZXMsIGFjY2Vzc1JvdXRlczsKICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIC8vIHN0YXJ0IHByb2dyZXNzIGJhcn4KICAgICAgICAgIE5Qcm9ncmVzcy5zdGFydCgpOwoKICAgICAgICAgIC8vIHNldCBwYWdlIHRpdGxlCiAgICAgICAgICBkb2N1bWVudC50aXRsZSA9IGdldFBhZ2VUaXRsZSh0by5tZXRhLnRpdGxlKTsKCiAgICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciB0aGUgdXNlciBoYXMgbG9nZ2VkIGluCiAgICAgICAgICBoYXNUb2tlbiA9IGdldFRva2VuKCk7CiAgICAgICAgICBpZiAoIWhhc1Rva2VuKSB7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzNTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoISh0by5wYXRoID09PSAnL2xvZ2luJykpIHsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgLy8gaWYgaXMgbG9nZ2VkIGluLCByZWRpcmVjdCB0byB0aGUgaG9tZSBwYWdlCiAgICAgICAgICBuZXh0KHsKICAgICAgICAgICAgcGF0aDogJy8nCiAgICAgICAgICB9KTsKICAgICAgICAgIE5Qcm9ncmVzcy5kb25lKCk7CiAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzM7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDk6CiAgICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciB0aGUgdXNlciBoYXMgb2J0YWluZWQgaGlzIHBlcm1pc3Npb24gcm9sZXMgdGhyb3VnaCBnZXRJbmZvCiAgICAgICAgICBoYXNSb2xlcyA9IHN0b3JlLmdldHRlcnMucm9sZXMgJiYgc3RvcmUuZ2V0dGVycy5yb2xlcy5sZW5ndGggPiAwOwogICAgICAgICAgaWYgKCFoYXNSb2xlcykgewogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgbmV4dCgpOwogICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxNDoKICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxNDsKICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNzsKICAgICAgICAgIHJldHVybiBzdG9yZS5kaXNwYXRjaCgndXNlci9nZXRJbmZvJyk7CiAgICAgICAgY2FzZSAxNzoKICAgICAgICAgIF95aWVsZCRzdG9yZSRkaXNwYXRjaCA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICByb2xlcyA9IF95aWVsZCRzdG9yZSRkaXNwYXRjaC5yb2xlczsKICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMTsKICAgICAgICAgIHJldHVybiBzdG9yZS5kaXNwYXRjaCgncGVybWlzc2lvbi9nZW5lcmF0ZVJvdXRlcycsIHJvbGVzKTsKICAgICAgICBjYXNlIDIxOgogICAgICAgICAgYWNjZXNzUm91dGVzID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgIC8vIGR5bmFtaWNhbGx5IGFkZCBhY2Nlc3NpYmxlIHJvdXRlcwogICAgICAgICAgcm91dGVyLmFkZFJvdXRlcyhhY2Nlc3NSb3V0ZXMpOwoKICAgICAgICAgIC8vIGhhY2sgbWV0aG9kIHRvIGVuc3VyZSB0aGF0IGFkZFJvdXRlcyBpcyBjb21wbGV0ZQogICAgICAgICAgLy8gc2V0IHRoZSByZXBsYWNlOiB0cnVlLCBzbyB0aGUgbmF2aWdhdGlvbiB3aWxsIG5vdCBsZWF2ZSBhIGhpc3RvcnkgcmVjb3JkCiAgICAgICAgICBuZXh0KF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdG8pLCB7fSwgewogICAgICAgICAgICByZXBsYWNlOiB0cnVlCiAgICAgICAgICB9KSk7CiAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzM7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI2OgogICAgICAgICAgX2NvbnRleHQucHJldiA9IDI2OwogICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSgxNCk7CiAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzA7CiAgICAgICAgICByZXR1cm4gc3RvcmUuZGlzcGF0Y2goJ3VzZXIvcmVzZXRUb2tlbicpOwogICAgICAgIGNhc2UgMzA6CiAgICAgICAgICBNZXNzYWdlLmVycm9yKF9jb250ZXh0LnQwIHx8ICdIYXMgRXJyb3InKTsKICAgICAgICAgIG5leHQoIi9sb2dpbj9yZWRpcmVjdD0iLmNvbmNhdCh0by5wYXRoKSk7CiAgICAgICAgICBOUHJvZ3Jlc3MuZG9uZSgpOwogICAgICAgIGNhc2UgMzM6CiAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzY7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDM1OgogICAgICAgICAgLyogaGFzIG5vIHRva2VuKi8KCiAgICAgICAgICBpZiAod2hpdGVMaXN0LmluZGV4T2YodG8ucGF0aCkgIT09IC0xKSB7CiAgICAgICAgICAgIC8vIGluIHRoZSBmcmVlIGxvZ2luIHdoaXRlbGlzdCwgZ28gZGlyZWN0bHkKICAgICAgICAgICAgbmV4dCgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gb3RoZXIgcGFnZXMgdGhhdCBkbyBub3QgaGF2ZSBwZXJtaXNzaW9uIHRvIGFjY2VzcyBhcmUgcmVkaXJlY3RlZCB0byB0aGUgbG9naW4gcGFnZS4KICAgICAgICAgICAgbmV4dCgiL2xvZ2luP3JlZGlyZWN0PSIuY29uY2F0KHRvLnBhdGgpKTsKICAgICAgICAgICAgTlByb2dyZXNzLmRvbmUoKTsKICAgICAgICAgIH0KICAgICAgICBjYXNlIDM2OgogICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICB9CiAgICB9LCBfY2FsbGVlLCBudWxsLCBbWzE0LCAyNl1dKTsKICB9KSk7CiAgcmV0dXJuIGZ1bmN0aW9uIChfeCwgX3gyLCBfeDMpIHsKICAgIHJldHVybiBfcmVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpKTsKcm91dGVyLmFmdGVyRWFjaChmdW5jdGlvbiAoKSB7CiAgLy8gZmluaXNoIHByb2dyZXNzIGJhcgogIE5Qcm9ncmVzcy5kb25lKCk7Cn0pOw=="},{"version":3,"names":["router","store","Message","NProgress","getToken","getPageTitle","configure","showSpinner","whiteList","beforeEach","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","to","from","next","hasToken","hasRoles","_yield$store$dispatch","roles","accessRoutes","wrap","_callee$","_context","prev","start","document","title","meta","path","done","getters","length","dispatch","sent","addRoutes","_objectSpread","replace","t0","error","concat","indexOf","stop","_x","_x2","_x3","apply","arguments","afterEach"],"sources":["C:/Users/maxch/Desktop/Bookmanager-master/project/Bookmanager-master/src/permission.js"],"sourcesContent":["/*\n * @Description: \n * @Author: Rabbiter\n * @Date: 2023-02-21 18:13:21\n */\nimport router from './router'\nimport store from './store'\nimport { Message } from 'element-ui'\nimport \"@/api/initialize\"\nimport NProgress from 'nprogress' // progress bar\nimport 'nprogress/nprogress.css' // progress bar style\nimport { getToken } from '@/utils/auth' // get token from cookie\nimport getPageTitle from '@/utils/get-page-title'\n\nNProgress.configure({ showSpinner: false }) // NProgress Configuration\n\nconst whiteList = ['/login', '/register'] // 没有重定向白名单\n\nrouter.beforeEach(async(to, from, next) => {\n  // start progress bar~\n  NProgress.start()\n\n  // set page title\n  document.title = getPageTitle(to.meta.title)\n\n  // determine whether the user has logged in\n  const hasToken = getToken()\n\n  if (hasToken) {\n    if (to.path === '/login') {\n      // if is logged in, redirect to the home page\n      next({ path: '/' })\n      NProgress.done()\n    } else {\n      // determine whether the user has obtained his permission roles through getInfo\n      const hasRoles = store.getters.roles && store.getters.roles.length > 0\n      if (hasRoles) {\n        next()\n      } else {\n        try {\n          // get user info\n          // note: roles must be a object array! such as: ['admin'] or ,['developer','editor']\n          const { roles } = await store.dispatch('user/getInfo')\n\n          // generate accessible routes map based on roles\n          const accessRoutes = await store.dispatch('permission/generateRoutes', roles)\n\n          // dynamically add accessible routes\n          router.addRoutes(accessRoutes)\n\n          // hack method to ensure that addRoutes is complete\n          // set the replace: true, so the navigation will not leave a history record\n          next({ ...to, replace: true })\n        } catch (error) {\n          // remove token and go to login page to re-login\n          await store.dispatch('user/resetToken')\n          Message.error(error || 'Has Error')\n          next(`/login?redirect=${to.path}`)\n          NProgress.done()\n        }\n      }\n    }\n  } else {\n    /* has no token*/\n\n    if (whiteList.indexOf(to.path) !== -1) {\n      // in the free login whitelist, go directly\n      next()\n    } else {\n      // other pages that do not have permission to access are redirected to the login page.\n      next(`/login?redirect=${to.path}`)\n      NProgress.done()\n    }\n  }\n})\n\nrouter.afterEach(() => {\n  // finish progress bar\n  NProgress.done()\n})\n"],"mappings":"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"}]}